package com.linroid.kdown

import kotlinx.io.files.Path
import kotlin.test.Test
import kotlin.test.assertEquals
import kotlin.test.assertFailsWith
import kotlin.test.assertNotEquals

class DownloadRequestTest {

  @Test
  fun defaultConnections_isFour() {
    val request = DownloadRequest(url = "https://example.com/file", destPath = Path("/tmp/file"))
    assertEquals(4, request.connections)
  }

  @Test
  fun taskId_autoGenerated() {
    val r1 = DownloadRequest(url = "https://example.com/file", destPath = Path("/tmp/file"))
    val r2 = DownloadRequest(url = "https://example.com/file", destPath = Path("/tmp/file"))
    assertNotEquals(r1.taskId, r2.taskId)
  }

  @Test
  fun customTaskId_preserved() {
    val request = DownloadRequest(
      url = "https://example.com/file",
      destPath = Path("/tmp/file"),
      taskId = "my-task"
    )
    assertEquals("my-task", request.taskId)
  }

  @Test
  fun blankUrl_throws() {
    assertFailsWith<IllegalArgumentException> {
      DownloadRequest(url = "", destPath = Path("/tmp/file"))
    }
    assertFailsWith<IllegalArgumentException> {
      DownloadRequest(url = "   ", destPath = Path("/tmp/file"))
    }
  }

  @Test
  fun zeroConnections_throws() {
    assertFailsWith<IllegalArgumentException> {
      DownloadRequest(url = "https://example.com/file", destPath = Path("/tmp/file"), connections = 0)
    }
  }

  @Test
  fun negativeConnections_throws() {
    assertFailsWith<IllegalArgumentException> {
      DownloadRequest(url = "https://example.com/file", destPath = Path("/tmp/file"), connections = -1)
    }
  }
}
